---
import type { HTMLAttributes } from 'astro/types';
import { tv, type VariantProps } from 'tailwind-variants';

type Props = Omit<HTMLAttributes<'input'>, 'type' | 'role'> & SwitchVariants;

export type SwitchVariants = VariantProps<typeof switchVariants>;

export const switchVariants = tv({
  slots: {
    base: 'flex items-center gap-2.5 select-none has-disabled:pointer-events-none has-disabled:opacity-50',
    control: [
      '@container flex shrink-0 appearance-none items-center overflow-hidden rounded-full px-0.5',
      'disabled:pointer-events-none disabled:opacity-50',
      'focus-visible:ring-accent-8 focus-visible:ring focus-visible:outline-none',
      'checked:bg-accent-9 checked:border-transparent',
      'before:rounded-[inherit] before:bg-linear-to-br before:shadow-md active:before:scale-[0.95]',
      'before:from-gray-contrast before:to-gray-contrast/60',
      'checked:before:from-accent-contrast checked:before:to-accent-contrast/60',
      'checked:before:translate-x-[calc(100cqw-100%)]',
      'rtl:checked:before:translate-x-[calc(-100cqw+100%)]',
      'motion-safe:transition-all motion-safe:before:transition-all',
    ],
  },
  defaultVariants: { size: '2', variant: 'soft-outline' },
  variants: {
    elevation: { '1': { control: 'elevation-1' }, '2': { control: 'elevation-2' }, '3': { control: 'elevation-3' } },
    size: {
      '1': { base: 'text-sm', control: 'h-4.5 w-8 before:size-3' },
      '2': { base: 'text-base', control: 'h-5 w-9 before:size-3.5' },
      '3': { base: 'text-lg', control: 'h-5.5 w-10 before:size-4' },
      '4': { base: 'text-xl', control: 'h-6 w-11 before:size-4.5' },
      '5': { base: 'text-2xl', control: 'h-6.5 w-12 before:size-5' },
    },
    variant: {
      solid: { control: 'bg-gray-1' },
      'solid-outline': { control: 'bg-gray-1 border-gray-7 border' },
      soft: { control: 'bg-gray-3' },
      'soft-outline': { control: 'bg-gray-3 border-gray-7 border' },
      outline: { control: 'border-gray-7 border' },
    },
  },
});

const { class: className, elevation, size, variant, ...props } = Astro.props;
const slots = switchVariants({ elevation, size, variant });
const Tag = Astro.slots.has('default') ? 'label' : Fragment;
---

<Tag data-slot="switch" class={slots.base({ className })}>
  <slot />
  <input data-slot="field-control" type="checkbox" role="switch" class={slots.control()} {...props} />
</Tag>
